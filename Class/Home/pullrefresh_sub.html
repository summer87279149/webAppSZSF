<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="full-screen" content="yes">
		<meta name="x5-fullscreen" content="true">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title></title>
		<!--引入less-->
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet/less" href="../../css/Home.less" />
		<script src="../../js/less.js" type="text/javascript"></script>
		<!--引入jq-->
		<script src="../../js/jquery.min.js"></script>
		<!--引入mui-->
		<script src="../../js/mui.js"></script>
		<!--引入vue-->
		<script src="../../js/vue.js" type="text/javascript" charset="utf-8"></script>
		<!--引入fastclick-->
		<script src="../../js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<!--引入图片查看器-->
		<link rel="stylesheet" type="text/css" href="../../css/ImagePreview.css" />
	</head>

	<body>

		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-scroll-wrapper bg">
			<div class="mui-scroll">
				<div class="top">
					<div class="img">
						<img src="../../reaource/yangzhou.png" />
					</div>

					<!--javascript:functionWithAjax("search");-->
					<form @submit.prevent="searchClicked">
						<div class="mui-input-row mui-search" id="searchView">
							<input type="search" class="mui-input-clear" placeholder="" v-model="searchContent">
							<input type="submit" name="" id="" value="" />
							<div class="searchLeft">
								<img src="../../reaource/searchLeft.png" />
							</div>
							<div class="searchRight">
								<img src="../../reaource/serachRight.png" />
							</div>
						</div>
					</form>

				</div>

				<div id="slider" class="mui-slider">
					<div class="mui-slider-group mui-slider-loop" id="slider2">
						<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
						<div class="mui-slider-item mui-slider-item-duplicate">
							<a>
								<img src="../../reaource/ceshi1.png" data-preview-src="" data-preview-group="1">
							</a>
						</div>
						<div class="mui-slider-item mui-slider-item-duplicate">
							<a>
								<img src="../../reaource/ceshi1.png" data-preview-src="" data-preview-group="1">
							</a>
						</div>
						<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
						<!--<div class="mui-slider-item mui-slider-item-duplicate">
							<a >
								<img src="../../reaource/ceshi1.jpg" data-preview-src="" data-preview-group="1">
							</a>
						</div>-->
					</div>
				</div>
				<div class="mid">
					<ul class="mui-table-view mui-grid-view mui-grid-9">
						<li @click="pushToCatagory(1)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/3.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">漆器</div>
							</a>
						</li>
						<li @click="pushToCatagory(2)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/7.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">玉器</div>
							</a>
						</li>
						<li @click="pushToCatagory(3)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/6.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">琴筝</div>
							</a>
						</li>
						<li @click="pushToCatagory(4)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/13.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">盆景</div>
							</a>
						</li>
						<li @click="pushToCatagory(5)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/9.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">厨艺</div>
							</a>
						</li>
						<li @click="pushToCatagory(6)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/14.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">脚艺</div>
							</a>
						</li>
						<li @click="pushToCatagory(7)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/10.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">剪纸</div>
							</a>
						</li>
						<li @click="pushToCatagory(8)" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
							<a>
								<img class="mui-icon mui-icon-location" src="../../reaource/5.png" style="width: 40px;height: 40px;">
								<div class="mui-media-body">刺绣</div>
							</a>
						</li>
					</ul>
				</div>
				<div id="bottomList">
					<!--<div id="woyaoruzhu">
						我要入住 
					</div>-->
					<div class="mui-content">
						<div id="slider" class="mui-slider ">
							<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
								<img class="hengxian" src="../../reaource/hengxian.png" />
								<div class="mui-scroll">

									<a class="mui-control-item mui-active" @click="getHotShops(0)">
										热门
									</a>
									<a class="mui-control-item" @click="getNewShops(0)">
										新人
									</a>
									<a class="mui-control-item" @click="getNearShops(0)">
										附近
									</a>
									<a class="mui-control-item" @click="getEvents">
										活动
									</a>
								</div>

							</div>
						</div>
					</div>
					<!--{{aa}}-->
					<ul id="listView">
						<!--{{cellArr}}-->
						<li @click="cellClicked(item.id)" class="cellItem" v-for="(item,index) in cellArr">
							<div class='left'><img :src="dealFMImg(item.fmimg)" /></div>
							<div class='right'><b>{{item.dpname}}</b>
								<p>服务热线:{{item.tel}}</p>
								<p>门店地址:{{item.address}}</p>
								<p>经营范围：{{item.jyfw}}</p>
							</div>

						</li>
					</ul>
				</div>

			</div>
		</div>
		<script src="../../js/request.js"></script>
		<script src="../../js/mui.zoom.js"></script>
		<script src="../../js/mui.previewimage.js"></script>
		<script>
			mui.previewImage();
		</script>
		<script>
			$(function() {
				FastClick.attach(document.body);
			});
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					},

				}
			});
			//下拉刷新具体业务实现
			function pulldownRefresh() {
				app2.pulldownRefresh()
			}
			var count = 0;
			// 上拉加载具体业务实现 
			function pullupRefresh() {
				app2.pullupRefresh()
			}
			
			var app2 = new Vue({
				el: "#pullrefresh",
				data: {
//					aa: 'daddwedwe',
					searchContent: '',
					currentShopsType: 0, //当前选择的类型 热门：0，新人：1，附近：2
					page: 0,
					base64Data: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAb1BMVEUAAAAAev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8Aev8AAACubimgAAAAI3RSTlMAGfUTGfQTGPMSGPIYGhgaGBsXGxcbFxwXHBccFhwWHRYdHWufDPQAAAABYktHRACIBR1IAAAAB3RJTUUH4QETEBwooeTlkQAAAJVJREFUSMft1EkSgkAQRNFGUXFWHBDBibr/HTUwD5B/48Ig1y+io7u6MqUhf5hsNEY+j5hMgZ/FJ8Xc9ovos3T96utjbfqN/Nb0O/m96Uv5g+mP8ifTn+Ur01/ka9Nf5RvTt/I309/lH6Z/yr9Mn+Q71/MT8B34K/E58Enzv8R/K98HvnF8p3lr8F7izce7lbf3kJ/lDQp9HdBhgg3PAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAxLTE5VDE2OjI4OjQwKzA4OjAwpTDFwQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMS0xOVQxNjoyODo0MCswODowMNRtfX0AAAAASUVORK5CYII=',
					cellArr: []

				},
				methods: {
					pushToCatagory(e) {
						//						this.pushto('Maps.html', "分类店铺", {
						this.pushto('Catagory/Catagory.html', "分类店铺", {
							shopCatagory: e.toString()
						});
					},
					searchClicked() {
						//页面传值
						this.pushto('SearchResult.html', "搜索结果", {
							content: this.searchContent
						});

					},
					dealFMImg(fmimg) {
						return 'http://szsf.vxiaoxiao.com/' + fmimg
					},
					getHotShops(page) {

						if(page == 0) {
							this.page = page;
							this.cellArr = [];
						}

						console.log('当前page:', this.page)
						this.currentShopsType = 0;
						var that = this
						httprequest.getHotShops(page, function(data) {
							data.forEach(function(item) {
								that.cellArr.push(item)
							})
							mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
							mui('#pullrefresh').pullRefresh().endPullupToRefresh();
						}, function(err) {
							console.log('错误是', err)
							mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
							mui('#pullrefresh').pullRefresh().endPullupToRefresh();
						})
					},
					getNewShops(page) {
						if(page == 0) {
							this.page = page;
							this.cellArr = [];
						}
						this.currentShopsType = 1;
						var that = this
						httprequest.getNewShops(page, function(data) {
							data.forEach(function(item) {
								that.cellArr.push(item)
							})
							mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
						}, function(err) {
							console.log('错误是', err)
							mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
						})

					},
					getNearShops(page) {
						if(page == 0) {
							this.page = page;
							this.cellArr = [];
						}
						this.currentShopsType = 2;
						var that = this
						plus.geolocation.getCurrentPosition(function(p) {
							console.log("经纬度是", p.coords.latitude)
							var location = p.coords.latitude.toString() + "," + p.coords.longitude.toString()
							httprequest.getNearShops(page, location, function(data) {
								data.forEach(function(item) {
									that.cellArr.push(item)
								})
								mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
							}, function(err) {
								console.log('错误是', err)
								mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
							})
						}, function(e) {
							alert('地理位置错误: ' + e.message);
							mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
						});

					},
					getEvents() {
						this.page = 0;
						this.cellArr = [];
						this.currentShopsType = 3;
					},
					pullupRefresh() {
						mui('#pullrefresh').pullRefresh().endPullupToRefresh();
						switch(this.currentShopsType) {
							case 0:
								this.page++
									this.getHotShops(this.page)
								break;
							case 1:
								this.page++
									this.getNewShops(this.page)
								break;
							case 2:
								this.page++
									this.getNearShops(this.page)
								break;
							case 3:
								break;
						}
					},

					pulldownRefresh() {
						switch(this.currentShopsType) {
							case 0:
								this.getHotShops(0)
								break;
							case 1:
								this.getNewShops(0)
								break;
							case 2:
								this.getNearShops(0)
								break;
							case 3:
								break;
						}
					},
					cellClicked(shopId) {
						this.pushto('TecDetail.html', "分类店铺", {

							shopId: shopId.toString()
						});
					},
					pushto(id, title, params) {
						var a = Math.random().toString();
						var b = Math.random().toString();
						mui.openWindowWithTitle({
							url: id,
							id: id + a + b,
							extras: params,
							styles: {
								top: '0px', //新页面顶部位置 
								bottom: '0px', //新页面底部位置
							},
						}, {
							title: { //标题配置
								text: title, //标题文字
							},
							back: { //左上角返回箭头
								image: {
									base64Data: this.base64Data
								}
							}
						})

					}
				},
				computed: {

				},
				watch: {

				},
				mounted() {
					this.getHotShops(0)
					//					plus.nativeUI.alert('message', function() {
					//						console.log("User pressed!");
					//					}, "nativeUI", "OK");
					//					plus.nativeUI.showWaiting();
					//					plus.nativeUI.closeWaiting();
					//					plus.nativeUI.toast( message, options );
					

				}

			})
		</script>

	</body>

</html>